---
import Layout from "../layouts/Layout.astro";
import Input from "../components/Input";
import Button from "../components/Button";

interface User {
    username: string;
    gmail: string;
    
}
interface Creador {
    basic : User;
    logo: string;
    support_link: string;
}

const { cookies, redirect } = Astro;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

const creador: Creador = {
    basic: {
        username: "Creador",
        gmail: "hola@gmail.com",
    },
    logo: "https://avatars.githubusercontent.com/u/472319",
    support_link: "https://www.google.com",
};

const user: User = {
    username: "Creador",
    gmail: "adios@gmail.com",
};

if (!(accessToken && refreshToken)) {
    redirect("/login");
};

// TODO: comprobar tipo de usuario, si es creador o no

const iscreador = cookies.get("iscreador") !== undefined ? true : false;
---

<Layout title="KingRifa">
    <div class="flex flex-col items-center justify-center h-full">
        <div class="flex flex-col items-center justify-center w-96">
            {
                iscreador ? (
                <img src={creador.logo} class="w-24 h-24 rounded-full cursor-pointer" id="img"/>
                )
                :(
                <img src={creador.logo} class="w-24 h-24 rounded-full"/>
                )

            }
            <h1 class="text-2xl font-bold mt-4">{creador.basic.username}</h1>
            <p class="text-sm text-gray-500 mt-1">Gmail: {creador.basic.gmail}</p>
            {
                iscreador && (
                    <p class="text-sm text-gray-500 mt-1">Link soporte: {creador.support_link}</p>
                )
            }
            
            <form class="pt-4 flex flex-col items-center" action="/api/auth/edit">
                {
                    iscreador && (
                        <Input type="file" placeholder="Logo" extraClass="hidden" />
                    )
                }
                
                <Input name="username" type="text" placeholder="Nombre de usuario" />
                {
                    iscreador && (
                        <Input name="support_link" type="text" placeholder="Link soporte" />
                    )
                }
                {/* 
                <Input type="text" placeholder="Correo electrónico" />
                
                <Input type="password" placeholder="Contraseña" />
                <Input type="password" placeholder="Contraseña actual" />*/}
                <Button type="button" text="Actualizar"/>
            </form>
        </div>
    </div>
</Layout>

<script>
    const img = document.getElementById("img");
    img?.addEventListener("click", () => {
        const input = document.querySelector("input[type='file']") as HTMLInputElement;
        input?.click();
    });
</script>