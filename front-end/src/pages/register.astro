---
import Layout from '../layouts/Layout.astro';
import Button from '../components/Button.tsx';
import Input from '../components/Input';

const { cookies, redirect } = Astro;

const accessToken = cookies.get("sb-access-token");
const refreshToken = cookies.get("sb-refresh-token");

if (accessToken && refreshToken) {
  return redirect("/dashboard");
}
---

<Layout title="KingRifa">
	<main>
        <form action="/api/auth/register" id="form">
            <div class=" h-screen w-full flex flex-col justify-center items-center gap-6">
                <div class="flex flex-col gap-4">
                    <!--<Input name='username' placeholder='Nombre de usuario' extraClass='rounded-md'/>-->
                    <Input name='email' placeholder='Correo electrónico' type='email' extraClass='rounded-md'/>
                    <Input name='password' placeholder='Contraseña' type='password' extraClass='rounded-md'/>
                    <Input name='passwordConfirmation' placeholder='Confirmar contraseña' type='password' extraClass='rounded-md'/>
                </div>
                <div class="flex flex-col gap-1">
                    <p>Ya tiene una cuenta: <a href="login" class=" text-syracuse-orange">Inicia sesion</a></p>
                    <Button type='submit' text='REGISTRARSE' extraClass='rounded-sm'>
                </div>
                
            </div>
        </form>
	</main>
</Layout>

<script>
const form = document.querySelector('form');
form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    console.log('submit');
    const formData = new FormData(form);
    // send form data
    const res = await fetch('/api/auth/register', {
        method: 'POST',
        body: formData
    }).then(res => res.json()).
    then(data => console.log(data)).
    catch(err =>console.log(err));
});
</script>